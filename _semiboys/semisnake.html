---
title: Semisnake
order: 1
---

<style>
	#semisnake .semiboy-controls-container {
		display: flex;
		align-items: center;
	}
	#semisnake .semiboy-arrow-controls-container {font-family: "C64";}
	#semisnake .semiboy-arrow-controls-container span {
		display: inline-block;
		margin-left: 0.2em;
		transform: rotate(180deg);
	}
	#semisnake .semiboy-arrow-controls-container div + div {margin-top: 0.3em;}

	#semisnake .semiboy-controls-separator {margin: 0 var(--cell-dimension);}

	#semisnake canvas {box-shadow: 0 0 0 calc(2 * var(--pixel-dimension)) var(--gameboy3);}

	#semisnake .semiboy-length-container {margin-top: var(--cell-dimension);}
</style>



<div class="semiboy-game-screen semiboy-start-screen">
	<div>
		<i class="fa-solid fa-apple-whole"></i>
		<i class="fa-solid fa-worm"></i>
	</div>
	<div>SEMISNAKE</div>
	<button class="semiboy-dialog-btn semiboy-first-play-btn">PLAY</button>
</div>

<div class="semiboy-game-screen semiboy-instructions-screen">
	<div>EAT THE<br>APPLE</div>

	<div class="semiboy-controls-container">
		<div class="semiboy-arrow-controls-container">
			<div>↑</div>
			<div>←<span>↑</span><span>←</span></div>
		</div>

		<div class="semiboy-controls-separator">or</div>

		<div class="semiboy-wasd-controls-container">
			<div>W</div>
			<div>ASD</div>
		</div>
	</div>
</div>

<div class="semiboy-game-screen semiboy-gameplay-screen" id="semisnake-gameplay-screen">
	<div class="semiboy-length-container">LENGTH: <span class="semiboy-length">0</span></div>
</div>

<div class="semiboy-game-screen semiboy-lose-screen">
	<div>GAME OVER</div>
	<div>LENGTH: <span class="semiboy-length">0</span></div>
	<button class="semiboy-dialog-btn semiboy-play-again-btn">PLAY<br>AGAIN</button>
</div>

<div class="semiboy-game-screen semiboy-win-screen">
	<div>YOU WIN!</div>
	<div>LENGTH: <span class="semiboy-length">0</span></div>
	<button class="semiboy-dialog-btn semiboy-play-again-btn">PLAY<br>AGAIN</button>
</div>



<script>
	var penCellHeight = 10;
	var penCellWidth = 12;
	var penHeight = penCellHeight * cellDimension;
	var penWidth = penCellWidth * cellDimension;



	// Create snake body coordinates
	function createSnake() {
		snakeBody = [];

		for (let i = snakeLength - 1; i >= 0; i--) {
			snakeBody.push({
				x : i - 1,
				y : 0
			});
		}
	}



	// Generate random coordinates on pen
	function generateRandomCoords() {
		var randomX = Math.floor(Math.random() * penCellWidth);
		var randomY = Math.floor(Math.random() * penCellHeight);
		return {x: randomX, y: randomY};
	}

	// Create apple coordinates
	function createApple() {
		var proposedApplePosition = generateRandomCoords();
		var badApple = false;

		if (JSON.stringify(proposedApplePosition) == JSON.stringify(apple)) badApple = true;

		snakeBody.forEach(function(snakeBit) {
			if (JSON.stringify(proposedApplePosition) == JSON.stringify(snakeBit)) badApple = true;
		});

		if (badApple == true) createApple();
		else apple = proposedApplePosition;
	}



	// Check if snake ran into itself
	function checkCollision(x, y) {
		collision = false

		snakeBody.forEach(function(snakeBit) {
			if (snakeBit.x == x && snakeBit.y == y) collision = true;
		});

		return collision;
	}



	const semisnakeInstance = new p5((sketch) => {
		// Canvas setup function
		sketch.setup = () => {
			sketch.createCanvas(penWidth, penHeight);
			sketch.frameRate(10);
			sketch.noStroke();
			sketch.noLoop();
		}


		// Code to run every frame
		sketch.draw = () => {
			sketch.background(gameboy1);

			var nx = snakeBody[0].x;
			var ny = snakeBody[0].y;

			// Directional conditions that would make the player unfaily lose
			var upToDown = proposedDirection == "up" && currentDirection == "down";
			var downToUp = proposedDirection == "down" && currentDirection == "up";
			var leftToRight = proposedDirection == "left" && currentDirection == "right";
			var rightToLeft = proposedDirection == "right" && currentDirection == "left";

			// Don't finalize direction change unless player has made a fair move
			if (upToDown == false && downToUp == false && leftToRight == false && rightToLeft == false) {
				currentDirection = proposedDirection;
			}

			switch (currentDirection) {
				case "up":    ny--; break;
				case "down":  ny++; break;
				case "left":  nx--; break;
				case "right": nx++; break;
			}

			// If player genuinely loses
			if (
				nx == -1 ||
				nx == penCellWidth ||
				ny == -1 ||
				ny == penCellHeight ||
				checkCollision(nx, ny)
			) {
				$(".semiboy-lose-screen").maxZ(".semiboy-game-screen");
				sketch.noLoop();
				return;
			}

			// If snake eats apple, reset apple position
			if (nx == apple.x && ny == apple.y) {
				snakeLength++;
				$(".semiboy-length").html(snakeLength);

				// If player has eaten last apple i.e. won the game
				if (snakeLength == (penCellHeight * penCellWidth)) {
					$(".semiboy-win-screen").maxZ(".semiboy-game-screen");
					sketch.noLoop();
				} else createApple();
			}
			else tail = snakeBody.pop();

			tail = {
				x: nx,
				y: ny
			};
			snakeBody.unshift(tail);

			// Paint snake body
			snakeBody.forEach(function(snakeBit) {
				sketch.fill(gameboy3);
				sketch.rect(
					snakeBit.x * cellDimension,
					snakeBit.y * cellDimension,
					cellDimension,
					cellDimension
				);

				sketch.fill(gameboy2);
				sketch.rect(
					snakeBit.x * cellDimension + pixelDimension,
					snakeBit.y * cellDimension + pixelDimension,
					cellDimension - 2 * pixelDimension,
					cellDimension - 2 * pixelDimension
				);
			});
		
			// Paint apple
			sketch.fill(gameboy3);
			sketch.circle(
				(apple.x * cellDimension) + (cellDimension / 2),
				(apple.y * cellDimension) + (cellDimension / 2),
				cellDimension
			);
		}
	}, "semisnake-gameplay-screen");



	function semisnakeNewGame() {
		snakeLength = 2;
		$(".semiboy-length").html(snakeLength);

		proposedDirection = "right";
		currentDirection = "";
		apple = {x: 0, y: 0};

		createSnake();
		createApple();

		var lengthElement = $(".semiboy-length-container");
		lengthElement.parent().append(lengthElement);

		semisnakeInstance.loop();
	}



	// On keypresses
	$(document).keydown(function(e) {
		if (semiboyOn == true && semiboyGame == "semisnake") {
			e.preventDefault();

			if      (e.which == "38" || e.which == "87") proposedDirection = "up";
			else if (e.which == "40" || e.which == "83") proposedDirection = "down";
			else if (e.which == "37" || e.which == "65") proposedDirection = "left";
			else if (e.which == "39" || e.which == "68") proposedDirection = "right";
			else if (e.which == "82") $(".semiboy-play-again-btn").click();
		}
	});


	// On play button click
	$("#semisnake .semiboy-first-play-btn").click(function() {
		$("#semisnake .semiboy-instructions-screen").maxZ(".semiboy-game-screen");

		setTimeout(function() {
			$("#semisnake-gameplay-screen").maxZ(".semiboy-game-screen");
			semisnakeNewGame();
		}, instructionsDelay);
	});



	// On play again button click
	$("#semisnake .semiboy-play-again-btn").click(function() {
		$("#semisnake-gameplay-screen").maxZ(".semiboy-game-screen");
		semisnakeNewGame();
	});
</script>